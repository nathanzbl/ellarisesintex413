<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participants | Ella Rises</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #FFD7D1;
            --blue: #A8C0CC;
            --text-gray: #4A4A4A;
            --purple-accent: #C4B7D3;
            --flower-red: #D9414E;
            --dark-text: #1f2937;
            --light-bg: #f7f7f7;
            --success-green: #4CAF50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: white; font-family: 'Inter', 'Lato', sans-serif; color: var(--dark-text); }

        nav { background-color: var(--pink); padding: 12px 24px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; }
        .nav-container { max-width: 72rem; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
        .nav-logo { height: 40px; }
        .nav-links { display: flex; gap: 32px; }
        .nav-links a { color: var(--dark-text); text-decoration: none; font-weight: 500; padding: 8px 0; }
        .nav-links a:hover { color: var(--flower-red); }

        .page-header {
            background-color: var(--light-bg);
            padding: 40px 20px 20px;
            border-bottom: 2px solid var(--purple-accent);
        }
        .header-container { max-width: 72rem; margin: 0 auto; }
        .header-container h1 { font-size: 2.5rem; font-weight: 700; color: var(--dark-text); }
        .header-container p { color: var(--text-gray); margin-top: 8px; }

        .dashboard-container { max-width: 72rem; margin: 20px auto; padding: 0 20px; }
        .utility-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }
        .search-form {
            display: flex;
            flex-grow: 1;
            max-width: 400px;
        }
        .search-form input {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 6px 0 0 6px;
            flex-grow: 1;
        }
        .search-form button {
            background-color: var(--blue);
            color: var(--dark-text);
            padding: 10px 15px;
            border: 1px solid var(--blue);
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            font-weight: 500;
        }
        .add-btn {
            background-color: var(--flower-red);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .add-btn:hover { background-color: #c4323c; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.95rem;
        }
        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-bg);
        }
        .data-table th {
            background-color: var(--purple-accent);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
        }
        .data-table tr:hover { background-color: #fffafb; }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--dark-text);
            cursor: pointer;
            margin-right: 5px;
            font-size: 1rem;
            transition: color 0.2s;
        }
        .action-btn:hover { color: var(--flower-red); }
        .delete-btn:hover { color: #f44336; }
        .milestone-btn { color: var(--success-green); }

        footer { background-color: var(--blue); padding: 20px 20px; color: var(--dark-text); font-size: 0.9rem; text-align: center;}
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <img src="images/EllaRisesLogo.png.avif" alt="Ella Rises Logo" class="nav-logo">
            <div class="nav-links">
                <a href="/donations">Donations</a>
                <a href="/events">Events</a>
                <a href="/milestones">Milestones</a>
                <a href="/participants">Participants</a>
                <a href="/surveys">Surveys</a>
                
                <a href="/logout">Log Out</a>
            </div>
        </div>
    </nav>

    <% 
        if (!user) { 
    %>
        <div style="text-align: center; padding: 100px;">
            <h2>Access Denied</h2>
            <p>Please log in to view participant data.</p>
            <a href="/login" class="cta-btn" style="display: inline-block; margin-top: 20px;">Go to Login</a>
        </div>
    <% } else { %>
        
        <div class="page-header">
            <div class="header-container">
                <h1>Participant Management Dashboard</h1>
                <p>Welcome, <%= user.name %>! You are currently viewing the list of young women in Ella Rises.</p>
            </div>
        </div>

        <div class="dashboard-container">
            
            <div class="utility-bar">
                <form action="/participants/search" method="GET" class="search-form">
                    <input type="text" name="query" placeholder="Search by name, program, or ID..." value="<%= locals.searchQuery || '' %>">
                    <button type="submit">Search</button>
                </form>

                <% if (user.isManager) { %>
                    <button class="add-btn" onclick="openAddParticipantModal()">
                        + Add New Participant
                    </button>
                <% } %>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Program</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% 
                        for (let i = 0; i < locals.participants.length; i++) {
                            const participant = locals.participants[i];
                    %>
                        <tr>
                            <td><%= participant.id %></td>
                            <td><%= participant.firstName %> <%= participant.lastName %></td>
                            <td><%= participant.currentProgram %></td>
                            <td><%= participant.status %></td>
                            <td>
                                <button class="action-btn milestone-btn" title="Manage Milestones" onclick="openMilestoneModal(participant.id)">
                                    üåü Milestones
                                </button>
                                
                                <% if (user.isManager) { %>
                                    <button class="action-btn" title="Edit Participant" onclick="openEditParticipantModal(participant.id)">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="action-btn delete-btn" title="Delete Participant" onclick="confirmDelete(participant.id)">
                                        üóëÔ∏è
                                    </button>
                                <% } %>
                            </td>
                        </tr>
                    <% } %>
                    
                    <% if (locals.participants.length === 0) { %>
                        <tr>
                            <td colspan="5" style="text-align: center; color: var(--text-gray);">
                                No participants found matching your criteria.
                            </td>
                        </tr>
                    <% } %>
                    
                </tbody>
            </table>
        </div>
        
    <% } %>
    
    <footer>
        <p>¬© 2025 Ella Rises. Empowering Futures.</p>
    </footer>

    <script>
        function openAddParticipantModal() {
            console.log("Opening Add Participant Modal...");
        }

        function openEditParticipantModal(id) {
            console.log(`Opening Edit Participant Modal for ID: ${id}`);
        }

        function confirmDelete(id) {
            if (confirm(`Are you sure you want to delete participant ID ${id}? This action cannot be undone.`)) {
                console.log(`Deleting participant ID: ${id}`);
            }
        }

        function openMilestoneModal(id) {
            console.log(`Opening Milestones Modal for ID: ${id}`);
        }
    </script>
</body>
</html>