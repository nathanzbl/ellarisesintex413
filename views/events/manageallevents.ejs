<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage All Events | Ella Rises</title>

<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
    :root {
        --er-blue:#99B7C6;
        --er-lavender:#978EC4;
        --er-cream:#F9F5EA;
        --er-blush:#FFD8D1;
        --er-pink:#F9AFB1;
        --er-sage:#9AB59D;
        --er-charcoal:#3A3F3B;
        --er-rose:#CE325B;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0;
        font-family: "Montserrat", system-ui, sans-serif;
        background: var(--er-cream);
        color: var(--er-charcoal);
    }

    .main-content {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
        width: 100%;
    }

    .data-card {
        max-width: 1200px;
        width: 100%;
        padding: 2.5rem 2.25rem;
        border-radius: 1.5rem;
        background-color: #ffffff;
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.08);
        border-top: 6px solid var(--er-pink);
    }

    .milestone-title {
        font-family: "DM Serif Display", serif;
        font-size: 2rem;
        text-align: center;
        letter-spacing: 0.06em;
        margin: 0 0 0.25rem;
    }

    .milestone-subtitle {
        font-size: 0.95rem;
        text-align: center;
        color: rgba(58, 63, 59, 0.7);
        margin-bottom: 2rem;
    }

    .controls-bar {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-end;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--er-blush);
    }

    .search-form {
        display: flex;
        flex-grow: 1;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: flex-end;
        max-width: 100%;
    }

    .search-group {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        min-width: 160px;
    }

    .search-label {
        font-size: 0.75rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: var(--er-charcoal);
        text-transform: uppercase;
    }

    .search-input,
    .search-select {
        padding: 0.7rem 1rem;
        border: 2px solid var(--er-blush);
        border-radius: 0.75rem;
        font-family: inherit;
        font-size: 0.9rem;
        outline: none;
        transition: border-color 0.2s ease;
        background-color: #fff;
    }

    .search-input:focus,
    .search-select:focus {
        border-color: var(--er-pink);
    }

    .btn-search,
    .btn-clear {
        padding: 0.7rem 1rem;
        border-radius: 999px;
        border: none;
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.18s ease;
        width: 100%;
    }

    .btn-search {
        background: var(--er-sage);
        color: white;
        box-shadow: 0 5px 12px rgba(154, 181, 157, 0.4);
    }

    .btn-search:hover {
        background: rgba(154, 181, 157, 0.8);
    }

    .btn-clear {
        background: var(--er-blush);
        color: var(--er-charcoal);
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }

    .btn-clear:hover {
        background: var(--er-pink);
        color: white;
    }

    .search-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: space-between;
        width: 100%;
    }

    .search-actions .btn-search,
    .search-actions .btn-clear {
        width: auto;
    }

    .table-responsive {
        /* keep this for safety, but table should now fit */
        overflow-x: hidden;
        width: 100%;
        margin-top: 1.5rem;
    }

    .table-custom {
        width: 100%;
        border-collapse: collapse;
        /* removed min-width so it cannot force horizontal scroll */
    }

    .table-custom thead tr {
        background-color: var(--er-charcoal);
        color: var(--er-cream);
        font-size: 0.8rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
    }

    .table-custom th,
    .table-custom td {
        padding: 1rem 1.25rem;
        text-align: left;
        border-bottom: 1px solid var(--er-blush);
        /* let content wrap so it fits */
        white-space: normal;
    }

    .table-custom tbody tr:nth-child(even) {
        background-color: var(--er-cream);
    }

    .table-custom tbody tr:hover {
        background: #f4f7fb;
    }

    .actions-cell {
        display: flex;
        gap: 0.4rem;
        flex-wrap: nowrap;
    }

    .btn-small {
        padding: 0.75rem 1rem;
        border-radius: 999px;
        border: none;
        font-weight: 600;
        font-size: 0.65rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 5px 12px rgba(32, 131, 47, 0.25);
        transition: all 0.18s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        white-space: nowrap;
    }

    .btn-edit {
        background: var(--er-sage);
        color: #fff;
    }

    .btn-edit:hover {
        background: var(--er-blue);
        transform: translateY(-1px);
    }

    .btn-delete {
        background: var(--er-rose);
        color: #fff;
        box-shadow: 0 5px 12px rgba(206, 50, 91, 0.25);
    }

    .btn-delete:hover {
        background: #a82646;
        transform: translateY(-1px);
    }

    .no-results {
        text-align: center;
        padding: 1.25rem;
        font-size: 0.95rem;
        color: #555;
    }

    .pagination {
        margin-top: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
        font-size: 0.9rem;
    }

    .page-link,
    .page-link-disabled {
        padding: 6px 11px;
        border-radius: 999px;
        border: 1px solid #ddd;
        text-decoration: none;
        color: var(--er-charcoal);
        background: #fff;
        transition: background-color 0.15s ease,
                    border-color 0.15s ease,
                    color 0.15s ease;
    }

    .page-link:hover {
        border-color: var(--er-lavender);
        color: var(--er-lavender);
        background: #faf7ff;
    }

    .page-current {
        background: var(--er-lavender);
        color: #fff;
        border-color: var(--er-lavender);
        font-weight: 600;
    }

    .page-link-disabled {
        opacity: 0.4;
        pointer-events: none;
        cursor: default;
    }

    @media (max-width: 768px) {
        .data-card {
            padding: 2rem 1.25rem;
        }

        .milestone-title {
            font-size: 1.7rem;
        }
    }
</style>

</head>
<body>

<%- include('../common/navbar.ejs') %>

<div class="main-content">
  <div class="data-card">

    <h1 class="milestone-title">Manage All Events</h1>
    <p class="milestone-subtitle">
      Admin view of all scheduled events in the system.
    </p>

    <div class="controls-bar">
      <form method="GET" action="/events/manage/all" class="search-form">

        <div class="search-group" style="flex-basis: 25%;">
          <label class="search-label">Event Name</label>
          <input
            type="text"
            name="search_name"
            class="search-input"
            value="<%= search_name || '' %>"
          >
        </div>

        <div class="search-group" style="flex-basis: 20%;">
          <label class="search-label">Location</label>
          <input
            type="text"
            name="search_location"
            class="search-input"
            value="<%= search_location || '' %>"
          >
        </div>

        <div class="search-group" style="flex-basis: 20%;">
          <label class="search-label">Event Type</label>
          <select name="search_type" class="search-select">
            <option value="">All</option>
            <option value="Annual Conference"  <%= search_type === "Annual Conference"  ? "selected" : "" %>>Annual Conference</option>
            <option value="STEM" <%= search_type === "STEM" ? "selected" : "" %>>STEM</option>
            <option value="Arts" <%= search_type === "Arts" ? "selected" : "" %>>Arts</option>
            <option value="Leadership"    <%= search_type === "Leadership"    ? "selected" : "" %>>Leadership</option>
          </select>
        </div>

        <div class="search-group" style="flex-basis: 15%;">
          <label class="search-label">Start Date (min)</label>
          <input
            type="date"
            name="search_start"
            class="search-input"
            value="<%= search_start || '' %>"
          >
        </div>

        <div class="search-group" style="flex-basis: 15%;">
          <label class="search-label">Start Date (max)</label>
          <input
            type="date"
            name="search_end"
            class="search-input"
            value="<%= search_end || '' %>"
          >
        </div>

        <div class="search-group" style="flex-basis: 15%; flex-grow: 0;">
          <%
            const isSearching =
              (search_name && search_name.trim() !== "") ||
              (search_location && search_location.trim() !== "") ||
              (search_type && search_type.trim() !== "") ||
              (search_start && search_start !== "") ||
              (search_end && search_end !== "");
          %>

          <div class="search-actions">
            <button class="btn-search" type="submit">Search</button>

            <% if (isSearching) { %>
              <a href="/events/manage/all" class="btn-clear">Clear Filters</a>
            <% } %>
          </div>
        </div>

      </form>
    </div>

    <div class="table-responsive">
      <table class="table-custom">
        <thead>
          <tr>
            <th>Event Name</th>
            <th>Type</th>
            <th>Location</th>
            <th>Start</th>
            <th>End</th>
            <th colspan="2">Actions</th>
          </tr>
        </thead>

        <tbody>
          <% if (!events || events.length === 0) { %>
            <tr>
              <td colspan="7" class="no-results">
                No events found <%= isSearching ? 'matching your criteria.' : 'in the system.' %>
              </td>
            </tr>
          <% } else { %>
            <% events.forEach(ev => { %>
              <tr>
                <td><%= ev.eventname %></td>
                <td><%= ev.eventtype %></td>
                <td><%= ev.eventlocation %></td>
                <td><%= ev.startFormatted %></td>
                <td><%= ev.endFormatted %></td>
                <td class="actions-cell">
                  <a href="/events/edit/<%= ev.eventid %>" class="btn-small btn-edit">Edit</a>
                </td>
                <td class="actions-cell">
                  <form action="/events/delete/<%= ev.eventid %>" method="post">
                    <button class="btn-small btn-delete" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>

    <% if (pagination && pagination.totalPages > 1) { %>
      <div class="pagination">
        <%
          const hasPrev = pagination.currentPage > 1;
          const hasNext = pagination.currentPage < pagination.totalPages;

          function pageUrl(page) {
            let url = "/events/manage/all?page=" + page;

            if (search_name && search_name.trim() !== "") {
              url += "&search_name=" + encodeURIComponent(search_name.trim());
            }
            if (search_location && search_location.trim() !== "") {
              url += "&search_location=" + encodeURIComponent(search_location.trim());
            }
            if (search_type && search_type.trim() !== "") {
              url += "&search_type=" + encodeURIComponent(search_type.trim());
            }
            if (search_start && search_start !== "") {
              url += "&search_start=" + encodeURIComponent(search_start);
            }
            if (search_end && search_end !== "") {
              url += "&search_end=" + encodeURIComponent(search_end);
            }

            return url;
          }
        %>

        <% if (hasPrev) { %>
          <a class="page-link" href="<%= pageUrl(pagination.currentPage - 1) %>">
            Prev
          </a>
        <% } else { %>
          <span class="page-link-disabled">Prev</span>
        <% } %>

        <% if (pagination.windowStart > 1) { %>
          <a
            class="page-link <%= pagination.currentPage === 1 ? 'page-current' : '' %>"
            href="<%= pageUrl(1) %>"
          >
            1
          </a>

          <% if (pagination.windowStart > 2) { %>
            <a
              class="page-link"
              href="<%= pageUrl(Math.max(1, pagination.windowStart - pagination.windowSize)) %>"
            >
              ...
            </a>
          <% } %>
        <% } %>

        <% for (let p = pagination.windowStart; p <= pagination.windowEnd; p++) { %>
          <a
            class="page-link <%= p === pagination.currentPage ? 'page-current' : '' %>"
            href="<%= pageUrl(p) %>"
          >
            <%= p %>
          </a>
        <% } %>

        <% if (pagination.windowEnd < pagination.totalPages) { %>
          <% if (pagination.windowEnd < pagination.totalPages - 1) { %>
            <a
              class="page-link"
              href="<%= pageUrl(Math.min(pagination.totalPages, pagination.windowEnd + pagination.windowSize)) %>"
            >
              ...
            </a>
          <% } %>

          <a
            class="page-link <%= pagination.currentPage === pagination.totalPages ? 'page-current' : '' %>"
            href="<%= pageUrl(pagination.totalPages) %>"
          >
            <%= pagination.totalPages %>
          </a>
        <% } %>

        <% if (hasNext) { %>
          <a class="page-link" href="<%= pageUrl(pagination.currentPage + 1) %>">
            Next
          </a>
        <% } else { %>
          <span class="page-link-disabled">Next</span>
        <% } %>
      </div>
    <% } %>

  </div>
</div>

</body>
</html>
